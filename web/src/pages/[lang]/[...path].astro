---
import { getPageData } from '../../cms/getPageData'
import { getStaticPaths as getStaticPathsCms } from '../../cms/getStaticPaths'
import { locales } from '../../cms/locales'
import type { Locale } from '../../cms/types'
import Section from '../../components/ui/Section.astro'
import HeroSection from '../../layout/HeroSection.astro'
import Layout from '../../layout/Layout.astro'

export async function getStaticPaths() {
  return await getStaticPathsCms()
}

const props = Astro.props
const { lang } = Astro.params

if (!locales.includes(lang!)) {
  return Astro.redirect(Astro.url.pathname, 404)
}
const locale = lang as Locale

const pageData = await getPageData(props, locale)
---

<Layout {...pageData} lang={lang}>
  <HeroSection {...pageData.hero} />

  {pageData.sections?.map((section) => <Section {...section} />)}
</Layout>
