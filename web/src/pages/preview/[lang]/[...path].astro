---
import { getPageData } from '../../../cms/getPageData'
import { getPageProps } from '../../../cms/getPageProps'
import { locales } from '../../../cms/locales'
import type { Locale } from '../../../cms/types'
import LivePreviewRefreshPageScript from '../../../components/LivePreviewRefreshPageScript.astro'
import HeroSection from '../../../layout/HeroSection.astro'
import Layout from '../../../layout/Layout.astro'

// Preview mode, dont prerender these routes at build time
export const prerender = false

const { lang, path } = Astro.params

if (!locales.includes(lang!)) {
  return Astro.redirect(Astro.url.pathname, 404)
}
const locale = lang as Locale

const fullPath = `/${locale}${path ? '/' : ''}${path ?? ''}`

const pageProps = await getPageProps(fullPath)
const pageData = await getPageData(pageProps, locale, { preview: true })
---

<Layout {...pageData} lang={lang!}>
  <LivePreviewRefreshPageScript />

  <HeroSection {...pageData.hero} />
</Layout>
