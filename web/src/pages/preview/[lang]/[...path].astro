---
import { getPageData } from '../../../cms/getPageData'
import { getPageProps } from '../../../cms/getPageProps'
import { locales } from '../../../cms/locales'
import LivePreviewRefreshPageScript from '../../../components/LivePreviewRefreshPageScript.astro'
import Layout from '../../../layouts/Layout.astro'

// Preview mode, dont prerender these routes at build time
export const prerender = false

const { lang, path } = Astro.params

if (!locales.includes(lang!)) {
  return Astro.redirect(Astro.url.pathname, 404)
}

const fullPath = `/${lang}${path ? '/' : ''}${path ?? ''}`

const pageProps = await getPageProps(fullPath)
const pageData = await getPageData(pageProps)
---

<Layout {...pageData} lang={lang!}>
  <LivePreviewRefreshPageScript />

  <h1>Hello World</h1>

  {JSON.stringify(pageData, null, 2)}
</Layout>
