---
import type { PageData } from '@/cms/getPageData'
import RichTextBlock from '@/components/ui/blocks/RichTextBlock/RichTextBlock.astro'
import SectionShell from '@/layout/SectionShell.astro'
import { normalizePath } from '@/utils/normalizePath'
import { CldImage } from 'astro-cloudinary'
import type { Author, Media } from 'cms/src/payload-types'

type Props = {
  article: PageData['articles']
}

const { article } = Astro.props

const isPreview = Astro.url.pathname.startsWith('/preview')
---

<SectionShell>
  <h1 class="text-balance text-center text-4xl font-extrabold text-slate-700">
    {article.title}
  </h1>
  <div class="mb-12 mt-4 flex flex-row items-center justify-center gap-4">
    <CldImage
      src={(article.author.photo as Media).cloudinaryPublicId!}
      alt={article.author.name}
      width={100}
      height={100}
      class="!h-16 !w-16 rounded-full"
    />

    <div class="flex flex-col items-start gap-1 text-sm text-slate-700">
      <p>
        Geschrieben von:{'  '}<a
          class="text-primary underline"
          href={normalizePath((article.author as Author).path, isPreview)}>{article.author.name}</a
        >
      </p>

      <p>
        Zuletzt aktualisiert am:
        {
          new Date(article.updatedAt).toLocaleDateString('de-DE', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
          })
        }
      </p>
    </div>
  </div>

  <CldImage
    src={(article.image as Media).cloudinaryURL!}
    alt={(article.image as Media).alt}
    class="mx-auto my-8 !max-w-96"
    width={1920}
    height={1080}
  />

  <RichTextBlock text={article.content} />
</SectionShell>
